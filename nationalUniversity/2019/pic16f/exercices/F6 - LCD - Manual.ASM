errorlevel -203, -205, -302
LIST P=16F887
#include <P16F887.inc>
__CONFIG _CONFIG1,B'0010000011110100'

CBLOCK 0X20
ret_sel
ENDC

ORG 0
GOTO setup
ORG 4
GOTO INT
ORG 5
setup			CLRF PORTB				;INICIALIZA PUERTOS, BANDERAS 
				CLRF PORTD				;Y VARIABLES
				CLRF ret_sel
				CLRF TMR0
				CLRF INTCON
				BANKSEL OSCCON			;LFINTOSC, ESTABLE 
				MOVLW B'00001010'		;f=31KHz -> Tcy=129us
				MOVWF OSCCON
				BANKSEL ANSELH			
				CLRF ANSELH				;PORTB DIGITAL
				BANKSEL TRISB
				BCF TRISD,TRISD0		;RD0 ENABLE_OUT Y RD0 INT EXT
				BANKSEL WPUB			
				CLRF WPUB				
				BSF WPUB,WPUB0			;PULL UP EN RB0
				MOVLW B'00010000'
				MOVWF OPTION_REG		;PULL-UP EN B, TMR0 (OSC=fcy, Ps=2)
				BANKSEL INTCON
				BSF INTCON,INTE			;HABILITA INT EXT
				BSF INTCON,GIE			;INT GLOBALES HABILITADAS
				
main			SLEEP					;ESPERAR INT EXTERNA
				NOP
				BSF PORTD,RD0			;INT EXTERNA -> RD0=1
				
				BTFSC INTCON,T0IE
				GOTO $-1				;ESPERAR INT POR TMR0
				
				BCF PORTD,RD0			;60ms DESPUES RD0=0
				GOTO main
				
INT 			BTFSC INTCON,INTF		;HUBO INT EXT?
				CALL INT_EXT			;SI -> SETEAR TMR0
				BTFSS INTCON,INTF
				CALL INT_TMR0			;NO -> SETEAR INT EXTERNAS
				BCF INTCON,INTF			;BAJAR BANDERAS
				BCF INTCON,T0IF
				RETFIE

INT_EXT			MOVLW .25				;CARGA EN TMR0
				MOVWF TMR0
				BSF INTCON,T0IE			;HABILITAR INT POR TME0
				RETURN						

INT_TMR0		BCF INTCON,T0IE			;DESABILITA TEMPORALMENTE INT POR TMR0
				RETURN	
END