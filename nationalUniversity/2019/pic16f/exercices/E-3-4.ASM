errorlevel -203, -205, -302				;DISMINUIR ADVERTENCIAS MOLESTAS
LIST P=16F887
#include <P16F887.inc>
;CONFIG: MCLR OFF, WATCH-GOG OFF, OSCILADOR INTOSCIO, TODO LO DEMAS OFF
__CONFIG _CONFIG1, b'1110000011010100'

;EL PROGRAMA CALCULA EL OFFSET DE SALTO PARA LA TABLA, Y LA INTERRUPCION BUSCA EL RESULTADO
;EN LA TABLA SEGUN EL OFFSET Y LO MUESTRA EN EL PORTD CADA 65ms
 
offset EQU 0X20

ORG 0
GOTO setup
ORG 4
GOTO INT
ORG 5
setup			CLRF PORTA				;INICIALIZACIONES
				CLRF PORTB
				CLRF PORTD
				BANKSEL ANSEL			;PORTA Y B A DIGIAL
				CLRF ANSEL
				CLRF ANSELH
				BANKSEL TRISD			;RA4, RB0 INTRADAS Y PORTD SALIDA
				CLRF TRISD
				BANKSEL OPTION_REG
				CALL TMR0_setup			;CONFIG DEL TMR0 PARA 65ms
				BANKSEL PORTD
				CLRF INTCON				;BAJA BANDERAS, HABILITA INTERRUPCION POR TMR0
				BSF INTCON,T0IE			;Y GLOBALES
				BSF INTCON,GIE

main			BTFSC PORTA,RA4			;CALCULA EL OFFSET PARA IR A LA TABLA 
				BSF offset,0
				BTFSS PORTA,RA4
				BCF offset,0
				BTFSC PORTB,RB0
				BSF offset,1
				BTFSS PORTB,RB0
				BCF offset,1
				GOTO main

INT				BTFSC INTCON,T0IF		;PASARON 65ms?
				CALL INT_TMR0				
				RETFIE

INT_TMR0		CALL tabla				;BUSCAR RESULTADO, Y MOSTRAR EN PORTD
				MOVWF PORTD				
				CLRF TMR0				;CARGA TMR0 PARA 65ms Y BAJA BANDERA
				BCF INTCON,T0IF
				RETURN

tabla			MOVF offset,W			;TABLA DE VERDAD PARA offset
				ADDWF PCL,F
				RETLW 0XAA
				RETLW 0X55
				RETLW 0X0F
				RETLW 0XF0
				RETURN

;---------------CONFIGURACIONES----------------------------------------------
TMR0_setup		MOVLW b'11010111'		;TMR0: OSC=1MHz, PS=256 AL TMR0 
				MOVWF OPTION_REG
				CLRF TMR0				;LIMPIANDO PARA UN RETARDO MAX DE 65ms
				RETURN
END
				
				