errorlevel -203, -205, -302				;DISMINUIR ADVERTENCIAS MOLESTAS
LIST P=16F887
#include <P16F887.inc>
;CONFIG: MCLR OFF, WATCH-GOG OFF, OSCILADOR INTOSCIO, TODO LO DEMAS OFF
__CONFIG _CONFIG1, b'1110000011010100'

;EL PROGRAMA CALCULA LA CANTIDAD DE VECES QUE SE PULSA RA4, Y LA INTERRUPCIO MUESTARA EL
;RESULTADO CADA 50ms (se usan 2 timers)

contador EQU 0X20

#define carga_TMR1H_10ms MOVLW b'01101100' 
#define carga_TMR1L_10ms MOVLW b'11110000'
#define carga_TMR2_50ms MOVLW .60

ORG 0 
GOTO setup
ORG 4
GOTO INT
ORG 5
setup			CLRF PORTA				;INICIALIZACIONES
				CLRF PORTB
				CLRF contador			
				BANKSEL ANSEL			;PORTA Y B A DIGITAL
				CLRF ANSEL
				CLRF ANSELH
				BANKSEL TRISB			;RA4 ENTRADA, RB0-RB3 SALIDAS
				CLRF TRISB
				BANKSEL T1CON
				CALL TMR1_setup			;CONFIG TMR1 PARA 10ms
				BANKSEL T2CON
				CALL TMR2_setup			;CONFIG TMR2 PARA 50ms
				BANKSEL PORTA
				BSF INTCON,PEIE			;ACTIVA INT POR PERISF Y GLOBALES
				BSF INTCON,GIE
				BSF T2CON,TMR2ON		;COMIENZA CUENTA DEL TMR2 PARA INTERRUMPIR CADA 50ms

main			BTFSC PORTA,RA4			;GUARDA LA CANTIDAD DE VECES PRESIONA DO RA4 
				GOTO $-1				;EN contador CUIDANDO QUE NO DESBORDE
				INCF contador,F
				BTFSC contador,4
				CLRF contador
				CALL ret10ms
				GOTO main

ret10ms			BSF T1CON,TMR1ON		;RETARDO POR TMR1 ENTRE CADA PULSACION 
				BTFSS PIR1,TMR1IF
				GOTO $-1
				BCF T1CON,TMR1ON
				carga_TMR1H_10ms
				MOVWF TMR1H
				carga_TMR1L_10ms
				MOVWF TMR1L
				BCF PIR1,TMR1IF
				RETURN

INT				BTFSC PIR1,TMR2IF		;SI LLAMO EL TMR2 MOSTRAR contador EN PORTB
				CALL INT_TMR2
				RETFIE

INT_TMR2		MOVF contador,W			;PONE contador EN PORTB, RECARGA EL TMR2
				MOVWF PORTB				;Y BAJA BANDERAS
				carga_TMR2_50ms
				MOVWF TMR2
				BCF PIR1,TMR2IF
				RETURN

;---------------CONFIGURACIONES---------------------------------------------------------
TMR1_setup		CLRF T1CON				;TMR1: ps=1, OSC=1MHz, OFF
				carga_TMR1H_10ms		;CARGA TMR1 PARA 10ms
				MOVWF TMR1H
				carga_TMR1L_10ms
				MOVWF TMR1L
				MOVWF TMR1L
				RETURN

TMR2_setup		COMF T2CON,F			;TMR2: ps=16, PS=16, OFF
				BCF T2CON,TMR2ON
				carga_TMR2_50ms			;CARGA TMR2 PARA 50ms, Y ACTIVA 
				MOVWF TMR2				;INTERRUPCION POR TMR2
				BANKSEL PIE1			
				BSF PIE1,TMR2IE
				RETURN
END